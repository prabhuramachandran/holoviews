



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>holoviews.core.io &mdash; HoloViews</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/bootstrap.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/codehilite.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/rtd_bootstrap.css" type="text/css" />
  
        <link rel="author" title="About these documents"
              href="../../../about.html"/>
    <link rel="top" title="HoloViews" href="../../../index.html"/>
        <link rel="up" title="holoviews.core" href="../core.html"/>
    <script type="text/javascript" src='../../../_static/jquery.js'></script>
    <script type="text/javascript" src='../../../_static/underscore.js'></script>
    <script type="text/javascript" src='../../../_static/doctools.js'></script>
    <script type="text/javascript" src='../../../_static/require.js'></script>
    <script type="text/javascript" src='../../../_static/bootstrap.js'></script>
    <script type="text/javascript" src='../../../_static/custom.js'></script>
    <script type="text/javascript" src='../../../_static/js/theme.js'></script>



  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">

        
          <img src="../../../_static/holoviews_logo.png" class="logo" />
        

        <a href="../../../index.html" class="fa"> HoloViews</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Tutorials/index.html">Tutorials</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Examples/index.html">Examples</a><ul class="simple">
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Reference_Manual/index.html">Reference Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../Reference_Manual/holoviews.core.html">core</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Reference_Manual/holoviews.element.html">element</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Reference_Manual/holoviews.interface.html">interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Reference_Manual/holoviews.ipython.html">ipython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Reference_Manual/holoviews.operation.html">operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../Reference_Manual/holoviews.plotting.html">plotting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/ioam/holoviews">Github source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a><ul class="simple">
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">HoloViews</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="main">
            
  <h1>Source code for holoviews.core.io</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Module defining input/output interfaces to HoloViews.</span>

<span class="sd">There are two components for input/output:</span>

<span class="sd">Exporters: Process (composite) HoloViews objects one at a time. For</span>
<span class="sd">           instance, an exporter may render a HoloViews object as a</span>
<span class="sd">           svg or perhaps pickle it.</span>

<span class="sd">Archives: A collection of HoloViews objects that are first collected</span>
<span class="sd">          then processed together. For instance, collecting HoloViews</span>
<span class="sd">          objects for a report then generating a PDF or collecting</span>
<span class="sd">          HoloViews objects to dump to HDF5.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">zipfile</span><span class="o">,</span> <span class="nn">tarfile</span><span class="o">,</span> <span class="nn">shutil</span><span class="o">,</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">pickle</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>

<span class="kn">import</span> <span class="nn">param</span>
<span class="kn">from</span> <span class="nn">param.parameterized</span> <span class="kn">import</span> <span class="n">bothmethod</span>

<span class="kn">from</span> <span class="nn">.options</span> <span class="kn">import</span> <span class="n">Store</span>
<span class="kn">from</span> <span class="nn">.util</span> <span class="kn">import</span> <span class="n">unique_iterator</span><span class="p">,</span> <span class="n">sanitize_identifier</span>
<span class="kn">from</span> <span class="nn">.ndmapping</span> <span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">UniformNdMapping</span>
<span class="kn">from</span> <span class="nn">.layout</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">.dimension</span> <span class="kn">import</span> <span class="n">LabelledData</span>


<div class="viewcode-block" id="Reference"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Reference">[docs]</a><span class="k">class</span> <span class="nc">Reference</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Reference allows access to an object to be deferred until it is</span>
<span class="sd">    needed in the appropriate context. References are used by</span>
<span class="sd">    Collector to capture the state of an object at collection time.</span>

<span class="sd">    One particularly important property of references is that they</span>
<span class="sd">    should be pickleable. This means that you can pickle Collectors so</span>
<span class="sd">    that you can unpickle them in different environments and still</span>
<span class="sd">    collect from the required object.</span>

<span class="sd">    A Reference only needs to have a resolved_type property and a</span>
<span class="sd">    resolve method. The constructor will take some specification of</span>
<span class="sd">    where to find the target object (may be the object itself).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
<div class="viewcode-block" id="Reference.resolved_type"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Reference.resolved_type">[docs]</a>    <span class="k">def</span> <span class="nf">resolved_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the type of the object resolved by this references. If</span>
<span class="sd">        multiple types are possible, the return is a tuple of types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

</div>
<div class="viewcode-block" id="Reference.resolve"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Reference.resolve">[docs]</a>    <span class="k">def</span> <span class="nf">resolve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the referenced object. Optionally, a container may be</span>
<span class="sd">        passed in from which the object is to be resolved.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


</div></div>
<div class="viewcode-block" id="Exporter"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Exporter">[docs]</a><span class="k">class</span> <span class="nc">Exporter</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Exporter is a parameterized function that accepts a HoloViews</span>
<span class="sd">    object and converts it to a new some new format. This mechanism is</span>
<span class="sd">    designed to be very general so here are a few examples:</span>

<span class="sd">    Pickling:   Native Python, supported by HoloViews.</span>
<span class="sd">    Rendering:  Any plotting backend may be used (default uses matplotlib)</span>
<span class="sd">    Storage:    Saving to a database (e.g SQL), HDF5 etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># Mime-types that need encoding as utf-8 upon export</span>
    <span class="n">utf8_mime_types</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;image/svg+xml&#39;</span><span class="p">,</span> <span class="s">&#39;text/html&#39;</span><span class="p">,</span> <span class="s">&#39;text/json&#39;</span><span class="p">]</span>

    <span class="n">key_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      Function that generates the metadata key from the HoloViews</span>
<span class="s">      object being saved. The metadata key is a single</span>
<span class="s">      high-dimensional key of values associated with dimension labels.</span>

<span class="s">      The returned dictionary must have string keys and simple</span>
<span class="s">      literals that may be conviently used for dictionary-style</span>
<span class="s">      indexing. Returns an empty dictionary by default.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">info_fn</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;repr&#39;</span><span class="p">:</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)},</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      Function that generates additional metadata information from the</span>
<span class="s">      HoloViews object being saved.</span>

<span class="s">      Unlike metadata keys, the information returned may be unsuitable</span>
<span class="s">      for use as a key index and may include entries such as the</span>
<span class="s">      object&#39;s repr. Regardless, the info metadata should still only</span>
<span class="s">      contain items that will be quick to load and inspect. &quot;&quot;&quot;</span><span class="p">)</span>


    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Exporter.encode"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Exporter.encode">[docs]</a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Classmethod that applies conditional encoding based on</span>
<span class="sd">        mime-type. Given an entry as returned by __call__ return the</span>
<span class="sd">        data in the appropriate encoding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="k">if</span> <span class="n">info</span><span class="p">[</span><span class="s">&#39;mime_type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">utf8_mime_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span>
</div>
    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">_filename</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="s">&quot;Add the file extension if not already present&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">file_ext</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">file_ext</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filename</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">_merge_metadata</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">dicts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a merged metadata info dictionary from the supplied</span>
<span class="sd">        function and additional dictionaries</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">merged</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dicts</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="o">**</span><span class="n">fn</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span> <span class="k">if</span> <span class="n">fn</span> <span class="k">else</span> <span class="n">merged</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a HoloViews object return the raw exported data and</span>
<span class="sd">        corresponding metadata as the tuple (data, metadata). The</span>
<span class="sd">        metadata should include:</span>

<span class="sd">        &#39;file-ext&#39; : The file extension if applicable (else empty string)</span>
<span class="sd">        &#39;mime_type&#39;: The mime-type of the data.</span>

<span class="sd">        The fmt argument may be used with exporters that support multiple</span>
<span class="sd">        output formats. If not supplied, the exporter is to pick an</span>
<span class="sd">        appropriate format automatically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Exporter not implemented.&quot;</span><span class="p">)</span>


    <span class="nd">@bothmethod</span>
<div class="viewcode-block" id="Exporter.save"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Exporter.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">{},</span> <span class="n">info</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Similar to the call method except saves exporter data to disk</span>
<span class="sd">        into a file with specified basename. For exporters that</span>
<span class="sd">        support multiple formats, the fmt argument may also be</span>
<span class="sd">        supplied (which typically corresponds to the file-extension).</span>

<span class="sd">        The supplied metadata key and info dictionaries will be used</span>
<span class="sd">        to update the output of the relevant key and info functions</span>
<span class="sd">        which is then saved (if supported).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Exporter save method not implemented.&quot;</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="Importer"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Importer">[docs]</a><span class="k">class</span> <span class="nc">Importer</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">ParameterizedFunction</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Importer is a parameterized function that accepts some data in</span>
<span class="sd">    some format and returns a HoloViews object. This mechanism is</span>
<span class="sd">    designed to be very general so here are a few examples:</span>

<span class="sd">    Unpickling: Native Python, supported by HoloViews.</span>
<span class="sd">    Servers:    Loading data over a network connection.</span>
<span class="sd">    Storage:    Loading from a database (e.g SQL), HDF5 etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given raw data in the appropriate format return the</span>
<span class="sd">        corresponding HoloViews object. Acts as the inverse of</span>
<span class="sd">        Exporter when supplied the data portion of an Exporter&#39;s</span>
<span class="sd">        output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Importer not implemented.&quot;</span><span class="p">)</span>


    <span class="nd">@bothmethod</span>
<div class="viewcode-block" id="Importer.load"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Importer.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">entry</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given some source (e.g. a filename, a network connection etc),</span>
<span class="sd">        return the loaded HoloViews object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Importer load method not implemented.&quot;</span><span class="p">)</span>

</div>
    <span class="nd">@bothmethod</span>
<div class="viewcode-block" id="Importer.info"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Importer.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the &#39;info&#39; portion of the metadata (if available).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Importer info method not implemented.&quot;</span><span class="p">)</span>
</div>
    <span class="nd">@bothmethod</span>
<div class="viewcode-block" id="Importer.key"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Importer.key">[docs]</a>    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the metadata key (if available).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Importer keys method not implemented.&quot;</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="Serializer"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Serializer">[docs]</a><span class="k">class</span> <span class="nc">Serializer</span><span class="p">(</span><span class="n">Exporter</span><span class="p">):</span>
    <span class="s">&quot;A generic exporter that supports any arbitrary serializer&quot;</span>

    <span class="n">serializer</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">dumps</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       The serializer function, set to Store.dumps by default. The</span>
<span class="s">       serializer should take an object and output a serialization as</span>
<span class="s">       a string or byte stream.</span>

<span class="s">       Any suitable serializer may be used. For instance, pickle.dumps</span>
<span class="s">       may be used although this will not save customized options.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">mime_type</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&#39;application/python-pickle&#39;</span><span class="p">,</span> <span class="n">allow_None</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       The mime-type associated with the serializer (if applicable).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">file_ext</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&#39;pkl&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       The file extension associated with the corresponding file</span>
<span class="s">       format (if applicable).&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serializer</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;file-ext&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_ext</span><span class="p">,</span> <span class="s">&#39;mime_type&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">mime_type</span><span class="p">}</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{},</span> <span class="n">key</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">base_info</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_merge_metadata</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">key_fn</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_merge_metadata</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">info_fn</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">base_info</span><span class="p">)</span>
        <span class="n">metadata</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="p">({</span><span class="s">&#39;info&#39;</span><span class="p">:</span><span class="n">info</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;ab&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="Deserializer"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Deserializer">[docs]</a><span class="k">class</span> <span class="nc">Deserializer</span><span class="p">(</span><span class="n">Importer</span><span class="p">):</span>
    <span class="s">&quot;A generic importer that supports any arbitrary de-serializer.&quot;</span>

    <span class="n">deserializer</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       The deserializer function, set to Store.load by default. The</span>
<span class="s">       deserializer should take a file-like object that can be read</span>
<span class="s">       from until the first object has been deserialized. If the file</span>
<span class="s">       has not been exhausted, the deserializer should be able to</span>
<span class="s">       continue parsing and loading objects.</span>

<span class="s">       Any suitable deserializer may be used. For instance,</span>
<span class="s">       pickle.load may be used although this will not load customized</span>
<span class="s">       options.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span> <span class="p">{})</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">deserializer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">metadata</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;info&#39;</span><span class="p">,</span> <span class="p">{})</span>


</div>
<div class="viewcode-block" id="Pickler"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Pickler">[docs]</a><span class="k">class</span> <span class="nc">Pickler</span><span class="p">(</span><span class="n">Exporter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The recommended pickler for serializing HoloViews object to a .hvz</span>
<span class="sd">    file (a simple zip archive of pickle files). In addition to the</span>
<span class="sd">    functionality offered by Store.dump and Store.load, this file</span>
<span class="sd">    format offers three additional features:</span>

<span class="sd">    1. Optional (zip) compression.</span>
<span class="sd">    2. Ability to save and load components of a Layout independently.</span>
<span class="sd">    3. Support for metadata per saved component.</span>

<span class="sd">    The output file with the .hvz file extension is simply a zip</span>
<span class="sd">    archive containing pickled HoloViews objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">protocol</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The pickling protocol where 0 is ASCII, 1 supports old Python</span>
<span class="s">        versions and 2 is efficient for new style classes.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">compress</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Whether compression is enabled or not&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">mime_type</span> <span class="o">=</span> <span class="s">&#39;application/zip&#39;</span>
    <span class="n">file_ext</span> <span class="o">=</span> <span class="s">&#39;hvz&#39;</span>


    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">{},</span> <span class="n">info</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">buff</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">buff</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">buff</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">buff</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="p">{</span><span class="s">&#39;file-ext&#39;</span><span class="p">:</span> <span class="s">&#39;hvz&#39;</span><span class="p">,</span> <span class="s">&#39;mime_type&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">mime_type</span><span class="p">}</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">{},</span> <span class="n">info</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">base_info</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;file-ext&#39;</span><span class="p">:</span> <span class="s">&#39;hvz&#39;</span><span class="p">,</span> <span class="s">&#39;mime_type&#39;</span><span class="p">:</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">mime_type</span><span class="p">}</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_merge_metadata</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">key_fn</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_merge_metadata</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">info_fn</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">base_info</span><span class="p">)</span>
        <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span> <span class="k">if</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">compress</span> <span class="k">else</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">filename</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Layout</span><span class="p">):</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
                <span class="n">components</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="p">[</span><span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;(L)&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sanitize_identifier</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">False</span><span class="p">),</span>
                                      <span class="n">sanitize_identifier</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="bp">False</span><span class="p">))]</span>
                <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">component</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">components</span><span class="p">,</span> <span class="n">entries</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span>
                           <span class="n">Store</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">component</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="n">self_or_cls</span><span class="o">.</span><span class="n">protocol</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="s">&#39;metadata&#39;</span><span class="p">,</span>
                       <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s">&#39;info&#39;</span><span class="p">:</span><span class="n">info</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">}))</span>


</div>
<div class="viewcode-block" id="Unpickler"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Unpickler">[docs]</a><span class="k">class</span> <span class="nc">Unpickler</span><span class="p">(</span><span class="n">Importer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The inverse of Pickler used to load the .hvz file format which is</span>
<span class="sd">    simply a zip archive of pickle objects.</span>

<span class="sd">    Unlike a regular pickle file, info and key metadata as well as</span>
<span class="sd">    individual components of a Layout may be loaded without needing to</span>
<span class="sd">    load the entire file into memory.</span>

<span class="sd">    The components that may be individually loaded may be found using</span>
<span class="sd">    the entries method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">buff</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="n">entries</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">entries</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">components</span><span class="p">,</span> <span class="n">single_layout</span> <span class="o">=</span> <span class="p">[],</span> <span class="bp">False</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">entries</span> <span class="k">if</span> <span class="n">entries</span> <span class="k">else</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">entries</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">entry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Entry </span><span class="si">%s</span><span class="s"> not available&quot;</span> <span class="o">%</span> <span class="n">entry</span><span class="p">)</span>
                <span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">entry</span><span class="p">)))</span>
                <span class="n">single_layout</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;(L)&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">single_layout</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Layout</span><span class="o">.</span><span class="n">from_values</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">_load_metadata</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;metadata&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">namelist</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;No metadata available&quot;</span><span class="p">)</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s">&#39;metadata&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s">&quot;Entry </span><span class="si">%s</span><span class="s"> is missing from the metadata&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">metadata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">key</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_load_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;key&#39;</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self_or_cls</span><span class="o">.</span><span class="n">_load_metadata</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;info&#39;</span><span class="p">)</span>

    <span class="nd">@bothmethod</span>
    <span class="k">def</span> <span class="nf">entries</span><span class="p">(</span><span class="n">self_or_cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">el</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span> <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="s">&#39;metadata&#39;</span><span class="p">]</span>


</div>
<div class="viewcode-block" id="Archive"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Archive">[docs]</a><span class="k">class</span> <span class="nc">Archive</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An Archive is a means to collect and store a collection of</span>
<span class="sd">    HoloViews objects in any number of different ways. Examples of</span>
<span class="sd">    possible archives:</span>

<span class="sd">    * Generating tar or zip files (compressed or uncompressed).</span>
<span class="sd">    * Collating a report or document (e.g. PDF, HTML, LaTex).</span>
<span class="sd">    * Storing a collection of HoloViews objects to a database or HDF5.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exporters</span><span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[],</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The exporter functions used to convert HoloViews objects into the</span>
<span class="s">        appropriate format(s).&quot;&quot;&quot;</span>  <span class="p">)</span>

<div class="viewcode-block" id="Archive.add"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Archive.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a HoloViews object to the archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Archive.export"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.Archive.export">[docs]</a>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finalize and close the archive.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


</div></div>
<div class="viewcode-block" id="simple_name_generator"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.simple_name_generator">[docs]</a><span class="k">def</span> <span class="nf">simple_name_generator</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple name_generator designed for HoloViews objects.</span>

<span class="sd">    Objects are labeled with {group}-{label} for each nested</span>
<span class="sd">    object, based on a depth-first search.  Adjacent objects with</span>
<span class="sd">    identical representations yield only a single copy of the</span>
<span class="sd">    representation, to avoid long names for the common case of</span>
<span class="sd">    a container whose element(s) share the same group and label.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">LabelledData</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                              <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">group</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;-&#39;</span>  <span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">label</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">label</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">)))</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">labels</span><span class="p">)]</span>
        <span class="n">obj_str</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">obj_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj_str</span>


</div>
<div class="viewcode-block" id="FileArchive"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.FileArchive">[docs]</a><span class="k">class</span> <span class="nc">FileArchive</span><span class="p">(</span><span class="n">Archive</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A file archive stores files on disk, either unpacked in a</span>
<span class="sd">    directory or in an archive format (e.g. a zip file).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">exporters</span><span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="n">Pickler</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The exporter functions used to convert HoloViews objects into</span>
<span class="s">        the appropriate format(s).&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">dimension_formatter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;{name}_{range}&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        A string formatter for the output file based on the</span>
<span class="s">        supplied HoloViews objects dimension names and values.</span>
<span class="s">        Valid fields are the {name}, {range} and {unit} of the</span>
<span class="s">        dimensions.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">object_formatter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Callable</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">simple_name_generator</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Callable that given an object returns a string suitable for</span>
<span class="s">        inclusion in file and directory names. This is what generates</span>
<span class="s">        the value used in the {obj} field of the filename</span>
<span class="s">        formatter.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">filename_formatter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&#39;{dimensions},{obj}&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        A string formatter for output filename based on the HoloViews</span>
<span class="s">        object that is being rendered to disk.</span>

<span class="s">        The available fields are the {type}, {group}, {label}, {obj}</span>
<span class="s">        of the holoviews object added to the archive as well as</span>
<span class="s">        {timestamp}, {obj} and {SHA}. The {timestamp} is the export</span>
<span class="s">        timestamp using timestamp_format, {obj} is the object</span>
<span class="s">        representation as returned by object_formatter and {SHA} is</span>
<span class="s">        the SHA of the {obj} value used to compress it into a shorter</span>
<span class="s">        string.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">timestamp_format</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&quot;%Y_%m_</span><span class="si">%d</span><span class="s">-%H_%M_%S&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The timestamp format that will be substituted for the</span>
<span class="s">        {timestamp} field in the export name.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The root directory in which the output directory is</span>
<span class="s">        located. May be an absolute or relative path.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">archive_format</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">ObjectSelector</span><span class="p">(</span><span class="s">&#39;zip&#39;</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;zip&#39;</span><span class="p">,</span> <span class="s">&#39;tar&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The archive format to use if there are multiple files and pack</span>
<span class="s">        is set to True &quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">pack</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        Whether or not to pack to contents into the specified archive</span>
<span class="s">        format. If pack is False, the contents will be output to a</span>
<span class="s">        directory.</span>

<span class="s">        Note that if there is only a single file in the archive, no</span>
<span class="s">        packing will occur and no directory is created. Instead, the</span>
<span class="s">        file is treated as a single-file archive.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">export_name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s">&#39;{timestamp}&#39;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">        The name assigned to the overall export. If an archive file is</span>
<span class="s">        used, this is the correspond filename (e.g of the exporter zip</span>
<span class="s">        file). Alternatively, if unpack=False, this is the name of the</span>
<span class="s">        output directory. Lastly, for archives of a single file, this</span>
<span class="s">        is the basename of the output file.</span>

<span class="s">        The {timestamp} field is available to include the timestamp at</span>
<span class="s">        the time of export in the chosen timestamp format.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">unique_name</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       Whether the export name should be made unique with a numeric</span>
<span class="s">       suffix. If set to False, any existing export of the same name</span>
<span class="s">       will be removed and replaced.&quot;&quot;&quot;</span><span class="p">)</span>

    <span class="n">max_filename</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">None</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">       Maximum length to enforce on generated filenames.  100 is the</span>
<span class="s">       practical maximum for zip and tar file generation, but you may</span>
<span class="s">       wish to use a lower value to avoid long filenames.&quot;&quot;&quot;</span><span class="p">)</span>


    <span class="n">ffields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;obj&#39;</span><span class="p">,</span> <span class="s">&#39;SHA&#39;</span><span class="p">,</span> <span class="s">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s">&#39;dimensions&#39;</span><span class="p">}</span>
    <span class="n">efields</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;timestamp&#39;</span><span class="p">}</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="FileArchive.parse_fields"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.FileArchive.parse_fields">[docs]</a>    <span class="k">def</span> <span class="nf">parse_fields</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">formatter</span><span class="p">):</span>
        <span class="s">&quot;Returns the format fields otherwise raise exception&quot;</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parse</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">Formatter</span><span class="p">()</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
            <span class="k">return</span>  <span class="nb">set</span><span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">parse</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">SyntaxError</span><span class="p">(</span><span class="s">&quot;Could not parse formatter </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">formatter</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FileArchive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
        <span class="c">#  Items with key: (basename,ext) and value: (data, info)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_formatters</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_dim_formatter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">obj</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#39;&#39;</span>
        <span class="n">key_dims</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">kdims</span><span class="p">,</span> <span class="p">[</span><span class="n">UniformNdMapping</span><span class="p">])</span>
        <span class="n">constant_dims</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">cdims</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">map</span><span class="p">(</span><span class="n">dims</span><span class="o">.</span><span class="n">extend</span><span class="p">,</span> <span class="n">key_dims</span> <span class="o">+</span> <span class="n">constant_dims</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="n">unique_iterator</span><span class="p">(</span><span class="n">dims</span><span class="p">)</span>
        <span class="n">dim_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">dim</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim</span><span class="o">.</span><span class="n">pprint_value</span><span class="p">(</span><span class="n">lower</span><span class="p">),</span>
                            <span class="n">dim</span><span class="o">.</span><span class="n">pprint_value</span><span class="p">(</span><span class="n">upper</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">lower</span> <span class="o">==</span> <span class="n">upper</span><span class="p">:</span>
                <span class="nb">range</span> <span class="o">=</span> <span class="n">dim</span><span class="o">.</span><span class="n">pprint_value</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">range</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
            <span class="n">formatters</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="n">dim</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;range&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">,</span>
                          <span class="s">&#39;unit&#39;</span><span class="p">:</span> <span class="n">dim</span><span class="o">.</span><span class="n">unit</span><span class="p">}</span>
            <span class="n">dim_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimension_formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">formatters</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dim_strings</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_validate_formatters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_formatter</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ffields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Valid filename fields are: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ffields</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_fields</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_name</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efields</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Valid export fields are: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">efields</span><span class="p">)))</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_format</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()))</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Timestamp format invalid&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="FileArchive.add"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.FileArchive.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If a filename is supplied, it will be used. Otherwise, a</span>
<span class="sd">        filename will be generated from the supplied object. Note that</span>
<span class="sd">        if the explicit filename uses the {timestamp} field, it will</span>
<span class="sd">        be formatted upon export.</span>

<span class="sd">        The data to be archived is either supplied explicitly as</span>
<span class="sd">        &#39;data&#39; or automatically rendered from the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">[</span><span class="n">filename</span><span class="p">,</span> <span class="n">obj</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Either filename or a HoloViews object is &quot;</span>
                            <span class="s">&quot;needed to create an entry in the archive.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_fields</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="s">&#39;timestamp&#39;</span><span class="p">}):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Only the {timestamp} formatter may be used unless an object is supplied.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">[</span><span class="n">obj</span><span class="p">,</span> <span class="n">data</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Either an object or explicit data must be &quot;</span>
                            <span class="s">&quot;supplied to create an entry in the archive.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">data</span> <span class="ow">and</span> <span class="s">&#39;mime_type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">info</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;The mime-type must be supplied in the info dictionary &quot;</span>
                            <span class="s">&quot;when supplying data directly&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_formatters</span><span class="p">()</span>

        <span class="n">entries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">exporter</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exporters</span><span class="p">:</span>
                <span class="n">rendered</span> <span class="o">=</span> <span class="n">exporter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rendered</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span>
                <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">new_info</span><span class="p">)</span> <span class="o">=</span> <span class="n">rendered</span>
                <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="o">**</span><span class="n">new_info</span><span class="p">)</span>
                <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">entries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">))</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_content</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>

</div>
    <span class="k">def</span> <span class="nf">_add_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="p">(</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_filename</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">[(</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">ext</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_compute_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">hashfn</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">()</span>
            <span class="n">obj_str</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span> <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_formatter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_formatter</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">dimensions</span> <span class="o">=</span> <span class="n">dimensions</span> <span class="k">if</span> <span class="n">dimensions</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>

            <span class="n">hashfn</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">obj_str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
            <span class="n">format_values</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s">&#39;{timestamp}&#39;</span><span class="p">,</span>
                             <span class="s">&#39;dimensions&#39;</span><span class="p">:</span> <span class="n">dimensions</span><span class="p">,</span>
                             <span class="s">&#39;group&#39;</span><span class="p">:</span>   <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="s">&#39;no-group&#39;</span><span class="p">),</span>
                             <span class="s">&#39;label&#39;</span><span class="p">:</span>   <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;no-label&#39;</span><span class="p">),</span>
                             <span class="s">&#39;type&#39;</span><span class="p">:</span>    <span class="n">obj</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                             <span class="s">&#39;obj&#39;</span><span class="p">:</span>     <span class="n">obj_str</span><span class="p">,</span>
                             <span class="s">&#39;SHA&#39;</span><span class="p">:</span>     <span class="n">hashfn</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()}</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_formatter</span><span class="p">,</span>
                                    <span class="nb">dict</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="o">**</span><span class="n">format_values</span><span class="p">))</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_normalize_name</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;file-ext&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="p">(</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">unique_key</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_zip_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="n">archname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="s">&#39;zip&#39;</span><span class="p">,</span> <span class="n">root</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">archname</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">zipf</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                <span class="n">zipf</span><span class="o">.</span><span class="n">writestr</span><span class="p">((</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">)),</span><span class="n">Exporter</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_tar_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="n">archname</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="s">&#39;tar&#39;</span><span class="p">,</span> <span class="n">root</span><span class="p">))</span>
        <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarFile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">archname</span><span class="p">),</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tarf</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
                <span class="n">tarinfo</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">TarInfo</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
                <span class="n">filedata</span> <span class="o">=</span> <span class="n">Exporter</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
                <span class="n">tarinfo</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filedata</span><span class="p">)</span>
                <span class="n">tarf</span><span class="o">.</span><span class="n">addfile</span><span class="p">(</span><span class="n">tarinfo</span><span class="p">,</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">filedata</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_single_file_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="p">((</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">entry</span><span class="p">)</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">=</span> <span class="n">entry</span>
        <span class="n">full_fname</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>
        <span class="p">(</span><span class="n">unique_name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span><span class="p">(</span><span class="n">full_fname</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_normalize_name</span><span class="p">(</span><span class="n">unique_name</span><span class="p">),</span> <span class="n">ext</span><span class="o">=</span><span class="n">ext</span><span class="p">)</span>
        <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Exporter</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_directory_archive</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_name</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">root</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Exporter</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">_unique_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">,</span> <span class="n">existing</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find a unique basename for a new file/key where existing is</span>
<span class="sd">        either a list of (basename, ext) pairs or an absolute path to</span>
<span class="sd">        a directory.</span>

<span class="sd">        By default, uniqueness is enforced dependning on the state of</span>
<span class="sd">        the unique_name parameter (for export names). If force is</span>
<span class="sd">        True, this parameter is ignored and uniqueness is guaranteed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">force</span> <span class="k">else</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">skip</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="k">if</span> <span class="n">ext</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">ext</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">existing</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">split</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">existing</span><span class="p">))]</span>
            <span class="n">existing</span> <span class="o">=</span> <span class="p">[(</span><span class="n">n</span><span class="p">,</span> <span class="n">ex</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ex</span> <span class="k">else</span> <span class="n">ex</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span> <span class="ow">in</span> <span class="n">split</span><span class="p">]</span>
        <span class="n">new_name</span><span class="p">,</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">basename</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="ow">in</span> <span class="n">existing</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">basename</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_truncate_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">tail</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s">&#39;...&#39;</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">maxlen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_filename</span> <span class="k">if</span> <span class="n">maxlen</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">maxlen</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="n">maxlen</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[:</span><span class="n">max_len</span><span class="o">-</span><span class="p">(</span><span class="n">tail</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">join</span><span class="p">))]</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">basename</span><span class="p">[</span><span class="o">-</span><span class="n">tail</span><span class="p">:]</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">join</span> <span class="o">+</span> <span class="n">end</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basename</span><span class="p">,</span> <span class="n">ext</span><span class="p">)</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="n">basename</span>

        <span class="k">return</span> <span class="n">filename</span>


    <span class="k">def</span> <span class="nf">_normalize_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="p">):</span>
        <span class="n">basename</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;-+&#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">,</span><span class="n">basename</span><span class="p">)</span>
        <span class="n">basename</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;^[-,_]&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">basename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="FileArchive.export"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.FileArchive.export">[docs]</a>    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="p">{}):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the archive, directory or file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tval</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span> <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">timestamp</span>
        <span class="n">tstamp</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_format</span><span class="p">,</span> <span class="n">tval</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">tstamp</span><span class="p">)</span>
        <span class="n">export_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">export_name</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">_format</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">info</span><span class="p">),</span> <span class="n">ext</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span>
                 <span class="k">for</span> <span class="p">((</span><span class="n">base</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="c"># Make directory and populate if multiple files and not packed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">pack</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_directory_archive</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_single_file_archive</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive_format</span> <span class="o">==</span> <span class="s">&#39;zip&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_zip_archive</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">archive_format</span> <span class="o">==</span> <span class="s">&#39;tar&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tar_archive</span><span class="p">(</span><span class="n">export_name</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_files</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">filtered</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_fields</span><span class="p">(</span><span class="n">formatter</span><span class="p">)}</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">filtered</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;The number of files currently specified in the archive&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pprint</span><span class="p">()</span>

<div class="viewcode-block" id="FileArchive.contents"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.FileArchive.contents">[docs]</a>    <span class="k">def</span> <span class="nf">contents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxlen</span><span class="o">=</span><span class="mi">70</span><span class="p">):</span>
        <span class="s">&quot;Print the current (unexported) contents of the archive&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Empty </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_truncate_name</span><span class="p">(</span><span class="n">maxlen</span><span class="o">=</span><span class="n">maxlen</span><span class="p">,</span> <span class="o">*</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="p">]</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
            <span class="n">mime_type</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mime_type&#39;</span><span class="p">,</span> <span class="s">&#39;no mime type&#39;</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> : </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">max_len</span><span class="p">),</span> <span class="n">mime_type</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="FileArchive.listing"><a class="viewcode-back" href="../../../Reference_Manual/holoviews.core.html#holoviews.core.io.FileArchive.listing">[docs]</a>    <span class="k">def</span> <span class="nf">listing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&quot;Return a list of filename entries currently in the archive&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="p">,</span><span class="n">ext</span><span class="p">])</span> <span class="k">if</span> <span class="n">ext</span> <span class="k">else</span> <span class="n">f</span> <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">ext</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015 IOAM: Jean-Luc R. Stevens, Philipp Rudiger, and James A. Bednar.
    </p>
  </div>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-61554933-1', 'auto');
  ga('send', 'pageview');

  </script>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>